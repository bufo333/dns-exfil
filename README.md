# DNS Exfiltration Toolkit (Go)

A complete DNS exfiltration suite in Go, now with built-in key generation, client, and server:

> ⚠️ **Educational Use Only**  
> Use only on systems you own or have explicit permission to test.

---

## 🗝️ Key Generation

The `keygen` tool creates an X25519 keypair, writes raw 32-byte files, and updates your `.env`:

```bash
# Build and run:
go build -o dnsexfil-keygen ./keygen
./dnsexfil-keygen
```

This produces:
- `server.key`            — your private key
- `server_public.key`     — your public key
- Appends `SERVER_PUBLIC_KEY=server_public.key` to `.env`

**⚠️** Make sure `.env` also contains:
```env
SERVER_PRIVATE_KEY=server.key
SERVER_PUBLIC_KEY=server_public.key
```

---

## 🚀 Build the Binaries

```bash
go build -o dnsexfil-server ./server
go build -o dnsexfil-client ./client
```

---

## 👷 .env Configuration

```env
# X25519 keys (generated by keygen)
SERVER_PRIVATE_KEY=server.key
SERVER_PUBLIC_KEY=server_public.key

# (Any other env vars your setup requires)
```

---

## 🛡️ Encryption & Key Exchange

- **X25519 ECDH** for perfect forward secrecy
- **HKDF-SHA256** → 32 B AES key + 16 B HMAC key
- **AES-GCM** (12 B nonce ‖ ciphertext+tag)
- **HMAC-SHA256** for integrity
- **Unpadded Base32** for DNS safety

Each session uses a new ephemeral client key; the server’s long-term keypair is loaded from `server.key`.

---

## 📦 Features

- **Keygen**: one-step X25519 keypair generation
- **Client**:
    - ECDH handshake via DNS TXT
    - AES-GCM encryption + HMAC tag
    - Base32 encode → randomized, DNS-safe chunks
    - Retries on failure, adjustable pacing
- **Server**:
    - DNS listener (UDP) for A & TXT
    - Reassembles, decodes, verifies HMAC, decrypts
    - Timeout-based cleanup, per-session isolation
    - Writes `identifier.bin` to `--output-dir`

---

## ⚙️ CLI Flags

### Keygen

The `keygen` binary has no flags—simply run it to produce `server.key` and `server_public.key` and update `.env`.

### Server

| Flag              | Default                   | Description                               |
|-------------------|---------------------------|-------------------------------------------|
| `--port`          | `5300`                    | UDP port to listen on                     |
| `--domain`        | `xf.example.com`          | Delegated DNS domain                      |
| `--output-dir`    | `./output`                | Directory for recovered files             |
| `--server-key`    | `$SERVER_PRIVATE_KEY`     | Path to X25519 private key                |
| `--server-pubkey` | `$SERVER_PUBLIC_KEY`      | Path to X25519 public key                 |

### Client

| Flag             | Default            | Description                                    |
|------------------|--------------------|------------------------------------------------|
| `--server-ip`    | `127.0.0.1`        | DNS server IP                                  |
| `--server-port`  | `5300`             | DNS server port                                |
| `--file-path`    | *required*         | Path to the file you want to exfiltrate        |
| `--domain`       | `xf.example.com`   | Domain suffix for DNS queries                  |
| `--low`          | `500`              | Minimum delay (ms) between queries             |
| `--high`         | `1000`             | Maximum delay (ms) between queries             |

---

## 📁 Project Structure

```
.
├── keygen/
│   └── main.go           # X25519 key generation
├── client/
│   └── main.go           # Exfiltration client logic
├── server/
│   └── main.go           # DNS exfiltration server
├── .env                  # Paths to `server.key` + `server_public.key`
└── README.md
```

---

## 📜 License & Legal

Provided **as-is**, without warranty. Use only on systems you own or are authorized to test.  
Authors accept no liability for misuse.

---

## 🧠 Credit

Original Python implementation by John Burns, now ported to Go for performance, portability, and idiomatic style.  
Developed by [John Burns](https://github.com/bufo333).
```markdown
